# Design Document: Downloadable HTML Practice Interface

## Overview

This design creates a self-contained HTML practice interface with ElevenLabs.io aesthetic that users can download and use offline. After practice questions are generated, users receive a beautifully styled HTML file containing all questions, interactive functionality, and premium visual design. The interface works completely offline with no external dependencies.

## Architecture

### High-Level Flow

```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│   VocabGo App   │    │  HTML Generator  │    │  Downloaded     │
│                 │    │                  │    │  HTML File      │
│ • Generate Qs   │───►│ • Template       │───►│                 │
│ • Show Download │    │ • Inline CSS     │    │ • Self-contained│
│ • Trigger DL    │    │ • Inline JS      │    │ • Works offline │
└─────────────────┘    └──────────────────┘    └─────────────────┘
```

### HTML File Structure

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Questions - [Wordlist Name]</title>
    <style>
        /* All CSS inline - ElevenLabs aesthetic */
    </style>
</head>
<body>
    <div id="app">
        <!-- Practice interface -->
    </div>
    <script>
        /* All JavaScript inline - no external dependencies */
    </script>
</body>
</html>
```

## Components and Interfaces

### 1. HTML Generation Service

**Service: `practiceHtmlGenerator.ts`**

```typescript
interface HtmlGenerationOptions {
  wordlistName: string;
  questions: Question[];
  timestamp: Date;
}

interface GeneratedHtml {
  html: string;
  filename: string;
  size: number; // in bytes
}

class PracticeHtmlGenerator {
  generateHtml(options: HtmlGenerationOptions): GeneratedHtml
  private generateCSS(): string
  private generateJavaScript(questions: Question[]): string
  private generateTemplate(wordlistName: string): string
}
```

### 2. Download Integration

**Integration Point: Results View**

```typescript
// Add to existing ResultsView component
interface ResultsViewProps {
  // ... existing props
  practiceSetId: string;
  questions: Question[];
  wordlistName: string;
}

// New download functionality
const downloadHtml = async () => {
  const htmlGenerator = new PracticeHtmlGenerator();
  const result = htmlGenerator.generateHtml({
    wordlistName: props.wordlistName,
    questions: props.questions,
    timestamp: new Date()
  });
  
  // Trigger browser download
  const blob = new Blob([result.html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = result.filename;
  a.click();
  URL.revokeObjectURL(url);
};
```

## Data Models

### Question Data Structure

```typescript
interface Question {
  id: string;
  type: 'matching' | 'fill-blank' | 'multiple-choice';
  data: MatchingData | FillBlankData | MultipleChoiceData;
}

interface MatchingData {
  pairs: Array<{
    english: string;
    mandarin: string;
  }>;
  shuffledMandarin: string[];
}

interface FillBlankData {
  sentence: string;
  correctAnswer: string;
  acceptableVariations: string[];
}

interface MultipleChoiceData {
  sentence: string;
  targetWord: string;
  options: Array<{
    text: string;
    isCorrect: boolean;
  }>;
}
```

### Session State (JavaScript in HTML)

```javascript
// Embedded in generated HTML
const sessionState = {
  currentQuestionIndex: 0,
  answers: new Map(),
  startTime: Date.now(),
  completed: false,
  score: 0
};
```

## User Interface Design

### 1. HTML Page Layout

**Overall Structure:**
```html
<body>
  <div class="container">
    <header class="header">
      <h1 class="title">[Wordlist Name] Practice</h1>
      <div class="question-count">[X] Questions</div>
    </header>
    
    <main class="main">
      <div class="progress-section">
        <div class="progress-text">Question 1 of 15</div>
        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
      </div>
      
      <div class="question-area">
        <!-- Dynamic question content -->
      </div>
      
      <div class="navigation">
        <button class="btn-nav btn-prev">Previous</button>
        <button class="btn-nav btn-next">Next</button>
      </div>
    </main>
    
    <footer class="footer">
      <div class="credit">Generated by VocabGo</div>
    </footer>
  </div>
</body>
```

### 2. ElevenLabs CSS Design System

**Color Palette:**
```css
:root {
  /* Primary Colors */
  --color-black: #000000;
  --color-white: #ffffff;
  
  /* Grays */
  --color-gray-50: #fafafa;
  --color-gray-100: #f5f5f5;
  --color-gray-200: #e5e7eb;
  --color-gray-400: #9ca3af;
  --color-gray-600: #6b7280;
  
  /* Semantic Colors */
  --color-success: #10b981;
  --color-error: #ef4444;
  
  /* Spacing */
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  --space-2xl: 48px;
  --space-3xl: 64px;
  
  /* Typography */
  --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-size-sm: 14px;
  --font-size-base: 16px;
  --font-size-lg: 18px;
  --font-size-xl: 24px;
  --font-size-2xl: 36px;
  
  /* Border Radius */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-full: 9999px;
  
  /* Transitions */
  --transition-fast: 150ms ease-out;
  --transition-normal: 250ms ease-out;
  --transition-slow: 300ms ease-out;
}
```

**Base Styles:**
```css
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-family);
  font-size: var(--font-size-base);
  line-height: 1.5;
  color: var(--color-black);
  background: var(--color-white);
  -webkit-font-smoothing: antialiased;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: var(--space-3xl) var(--space-xl);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

@media (max-width: 768px) {
  .container {
    padding: var(--space-2xl) var(--space-lg);
  }
}
```

### 3. Question Type Designs

#### Matching Questions
```css
.matching-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-lg);
  margin: var(--space-xl) 0;
}

.matching-column {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
}

.matching-item {
  padding: var(--space-lg);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  background: var(--color-white);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-size: var(--font-size-base);
  text-align: center;
}

.matching-item:hover {
  background: var(--color-gray-50);
  border-color: var(--color-gray-400);
}

.matching-item.selected {
  border-color: var(--color-black);
  background: var(--color-gray-50);
}

.matching-item.correct {
  border-color: var(--color-success);
  background: rgba(16, 185, 129, 0.1);
}

.matching-item.incorrect {
  border-color: var(--color-error);
  background: rgba(239, 68, 68, 0.1);
}

@media (max-width: 768px) {
  .matching-container {
    grid-template-columns: 1fr;
    gap: var(--space-xl);
  }
}
```

#### Fill-in-the-Blank Questions
```css
.fill-blank-container {
  margin: var(--space-xl) 0;
}

.fill-blank-sentence {
  font-size: var(--font-size-lg);
  line-height: 1.6;
  margin-bottom: var(--space-lg);
  text-align: center;
}

.fill-blank-input {
  width: 100%;
  max-width: 400px;
  height: 44px;
  padding: 0 var(--space-md);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  background: var(--color-gray-50);
  font-size: var(--font-size-base);
  font-family: inherit;
  transition: border-color var(--transition-fast);
  margin: 0 auto;
  display: block;
}

.fill-blank-input:focus {
  outline: none;
  border-color: var(--color-black);
  background: var(--color-white);
}

.fill-blank-input.correct {
  border-color: var(--color-success);
}

.fill-blank-input.incorrect {
  border-color: var(--color-error);
}

.fill-blank-feedback {
  margin-top: var(--space-md);
  text-align: center;
  font-size: var(--font-size-sm);
  color: var(--color-gray-600);
}
```

#### Multiple Choice Questions
```css
.multiple-choice-container {
  margin: var(--space-xl) 0;
}

.multiple-choice-sentence {
  font-size: var(--font-size-lg);
  line-height: 1.6;
  margin-bottom: var(--space-xl);
  text-align: center;
}

.multiple-choice-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-md);
  max-width: 600px;
  margin: 0 auto;
}

.multiple-choice-option {
  padding: var(--space-lg);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-md);
  background: var(--color-white);
  cursor: pointer;
  transition: all var(--transition-fast);
  font-size: var(--font-size-base);
  text-align: left;
}

.multiple-choice-option:hover {
  background: var(--color-gray-50);
  border-color: var(--color-gray-400);
}

.multiple-choice-option.selected {
  border-color: var(--color-black);
  background: var(--color-gray-50);
}

.multiple-choice-option.correct {
  border-color: var(--color-success);
  background: rgba(16, 185, 129, 0.1);
}

.multiple-choice-option.incorrect {
  border-color: var(--color-error);
  background: rgba(239, 68, 68, 0.1);
}
```

### 4. Navigation and Controls

```css
.progress-section {
  margin-bottom: var(--space-xl);
  text-align: center;
}

.progress-text {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-gray-600);
  margin-bottom: var(--space-md);
}

.progress-bar {
  width: 100%;
  height: 4px;
  background: var(--color-gray-200);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: var(--color-black);
  transition: width var(--transition-slow);
  width: 0%;
}

.navigation {
  display: flex;
  justify-content: space-between;
  gap: var(--space-md);
  margin-top: var(--space-2xl);
}

.btn-nav {
  height: 44px;
  padding: 0 var(--space-lg);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-full);
  background: var(--color-white);
  color: var(--color-black);
  font-size: 15px;
  font-weight: 600;
  font-family: inherit;
  cursor: pointer;
  transition: all var(--transition-fast);
  min-width: 120px;
}

.btn-nav:hover:not(:disabled) {
  background: var(--color-gray-50);
  border-color: var(--color-gray-400);
}

.btn-nav:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.btn-nav.btn-primary {
  background: var(--color-black);
  color: var(--color-white);
  border-color: var(--color-black);
}

.btn-nav.btn-primary:hover:not(:disabled) {
  background: #1a1a1a;
}

@media (max-width: 768px) {
  .navigation {
    flex-direction: column;
  }
  
  .btn-nav {
    width: 100%;
  }
}
```

### 5. Results View Design

```css
.results-container {
  text-align: center;
  padding: var(--space-2xl) 0;
}

.results-score {
  font-size: var(--font-size-2xl);
  font-weight: 700;
  color: var(--color-black);
  margin-bottom: var(--space-lg);
}

.results-score.high-score {
  color: var(--color-success);
}

.results-breakdown {
  background: var(--color-white);
  border: 1px solid var(--color-gray-200);
  border-radius: var(--radius-lg);
  padding: var(--space-xl);
  margin: var(--space-xl) auto;
  max-width: 500px;
}

.results-message {
  font-size: var(--font-size-lg);
  color: var(--color-gray-600);
  margin-bottom: var(--space-lg);
}

.results-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: var(--space-lg);
  margin-top: var(--space-lg);
}

.results-stat {
  text-align: center;
}

.results-stat-value {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--color-black);
}

.results-stat-label {
  font-size: var(--font-size-sm);
  color: var(--color-gray-600);
  margin-top: var(--space-xs);
}
```

## JavaScript Functionality

### 1. Core Application Logic

```javascript
// Embedded in generated HTML
class PracticeApp {
  constructor(questions) {
    this.questions = questions;
    this.currentQuestionIndex = 0;
    this.answers = new Map();
    this.startTime = Date.now();
    this.completed = false;
    
    this.init();
  }
  
  init() {
    this.renderQuestion();
    this.updateProgress();
    this.bindEvents();
  }
  
  renderQuestion() {
    const question = this.questions[this.currentQuestionIndex];
    const container = document.getElementById('question-container');
    
    switch (question.type) {
      case 'matching':
        container.innerHTML = this.renderMatchingQuestion(question);
        this.bindMatchingEvents();
        break;
      case 'fill-blank':
        container.innerHTML = this.renderFillBlankQuestion(question);
        this.bindFillBlankEvents();
        break;
      case 'multiple-choice':
        container.innerHTML = this.renderMultipleChoiceQuestion(question);
        this.bindMultipleChoiceEvents();
        break;
    }
  }
  
  // Question rendering methods...
  renderMatchingQuestion(question) { /* ... */ }
  renderFillBlankQuestion(question) { /* ... */ }
  renderMultipleChoiceQuestion(question) { /* ... */ }
  
  // Event binding methods...
  bindMatchingEvents() { /* ... */ }
  bindFillBlankEvents() { /* ... */ }
  bindMultipleChoiceEvents() { /* ... */ }
  
  // Navigation methods...
  nextQuestion() { /* ... */ }
  previousQuestion() { /* ... */ }
  finishPractice() { /* ... */ }
  
  // Utility methods...
  updateProgress() { /* ... */ }
  calculateScore() { /* ... */ }
  showResults() { /* ... */ }
}

// Initialize app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  const questions = /* embedded question data */;
  new PracticeApp(questions);
});
```

### 2. Matching Question Logic

```javascript
class MatchingHandler {
  constructor(question, onAnswer) {
    this.question = question;
    this.onAnswer = onAnswer;
    this.selectedItems = [];
    this.connections = [];
  }
  
  handleItemClick(item, type, index) {
    if (this.selectedItems.length === 0) {
      // First selection
      this.selectItem(item, type, index);
    } else if (this.selectedItems.length === 1) {
      // Second selection - try to make connection
      const first = this.selectedItems[0];
      if (first.type !== type) {
        this.makeConnection(first, { item, type, index });
        this.clearSelections();
      } else {
        // Same type - replace selection
        this.clearSelections();
        this.selectItem(item, type, index);
      }
    }
  }
  
  makeConnection(first, second) {
    // Create visual connection line
    this.drawConnectionLine(first, second);
    
    // Store connection
    this.connections.push({ first, second });
    
    // Check if all connections made
    if (this.connections.length === this.question.data.pairs.length) {
      this.checkAnswers();
    }
  }
  
  drawConnectionLine(first, second) {
    // SVG line drawing logic
    const svg = document.getElementById('connections-svg');
    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    
    const firstRect = first.item.getBoundingClientRect();
    const secondRect = second.item.getBoundingClientRect();
    const svgRect = svg.getBoundingClientRect();
    
    line.setAttribute('x1', firstRect.right - svgRect.left);
    line.setAttribute('y1', firstRect.top + firstRect.height/2 - svgRect.top);
    line.setAttribute('x2', secondRect.left - svgRect.left);
    line.setAttribute('y2', secondRect.top + secondRect.height/2 - svgRect.top);
    line.setAttribute('stroke', '#000000');
    line.setAttribute('stroke-width', '2');
    
    // Animate line drawing
    const length = Math.sqrt(
      Math.pow(line.getAttribute('x2') - line.getAttribute('x1'), 2) +
      Math.pow(line.getAttribute('y2') - line.getAttribute('y1'), 2)
    );
    
    line.style.strokeDasharray = length;
    line.style.strokeDashoffset = length;
    
    svg.appendChild(line);
    
    // Animate
    setTimeout(() => {
      line.style.transition = 'stroke-dashoffset 300ms ease-out';
      line.style.strokeDashoffset = '0';
    }, 50);
  }
  
  checkAnswers() {
    let correct = 0;
    
    this.connections.forEach(connection => {
      const { first, second } = connection;
      const englishIndex = first.type === 'english' ? first.index : second.index;
      const mandarinIndex = first.type === 'mandarin' ? first.index : second.index;
      
      const isCorrect = this.question.data.pairs[englishIndex].mandarin === 
                       this.question.data.shuffledMandarin[mandarinIndex];
      
      if (isCorrect) {
        correct++;
        this.markConnectionCorrect(connection);
      } else {
        this.markConnectionIncorrect(connection);
      }
    });
    
    this.onAnswer({
      type: 'matching',
      correct: correct,
      total: this.question.data.pairs.length,
      connections: this.connections
    });
  }
}
```

## Error Handling

### JavaScript Error Handling

```javascript
// Global error handler
window.addEventListener('error', (event) => {
  console.error('Practice app error:', event.error);
  
  // Show user-friendly error message
  const errorDiv = document.createElement('div');
  errorDiv.className = 'error-message';
  errorDiv.innerHTML = `
    <div class="error-content">
      <h3>Something went wrong</h3>
      <p>Please refresh the page to try again.</p>
      <button onclick="location.reload()" class="btn-nav btn-primary">
        Refresh Page
      </button>
    </div>
  `;
  
  document.body.appendChild(errorDiv);
});

// Graceful degradation for missing features
function checkBrowserSupport() {
  const features = {
    localStorage: typeof Storage !== 'undefined',
    svg: document.createElementNS && document.createElementNS('http://www.w3.org/2000/svg', 'svg').createSVGRect,
    css3: window.CSS && CSS.supports('display', 'grid')
  };
  
  if (!features.svg) {
    // Fallback for matching questions without SVG lines
    console.warn('SVG not supported, using simplified matching interface');
  }
  
  if (!features.css3) {
    // Add fallback styles
    document.head.insertAdjacentHTML('beforeend', `
      <style>
        .matching-container { display: block; }
        .matching-column { margin-bottom: 24px; }
      </style>
    `);
  }
}
```

## Testing Strategy

### 1. HTML Generation Testing

```typescript
// Unit tests for HTML generator
describe('PracticeHtmlGenerator', () => {
  it('should generate valid HTML with all required elements', () => {
    const generator = new PracticeHtmlGenerator();
    const result = generator.generateHtml({
      wordlistName: 'Test Wordlist',
      questions: mockQuestions,
      timestamp: new Date()
    });
    
    expect(result.html).toContain('<!DOCTYPE html>');
    expect(result.html).toContain('Test Wordlist');
    expect(result.filename).toMatch(/test-wordlist-practice-\d{4}-\d{2}-\d{2}\.html/);
  });
  
  it('should include all CSS inline', () => {
    const generator = new PracticeHtmlGenerator();
    const result = generator.generateHtml(mockOptions);
    
    expect(result.html).toContain('<style>');
    expect(result.html).toContain('--color-black: #000000');
    expect(result.html).not.toContain('link rel="stylesheet"');
  });
  
  it('should include all JavaScript inline', () => {
    const generator = new PracticeHtmlGenerator();
    const result = generator.generateHtml(mockOptions);
    
    expect(result.html).toContain('<script>');
    expect(result.html).toContain('class PracticeApp');
    expect(result.html).not.toContain('script src=');
  });
});
```

### 2. Cross-Browser Testing

**Manual Testing Checklist:**
- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest)
- [ ] Edge (latest)
- [ ] Mobile Safari (iOS)
- [ ] Chrome Mobile (Android)

**Test Scenarios:**
- [ ] All question types render correctly
- [ ] Navigation works properly
- [ ] Progress tracking updates
- [ ] Results calculation is accurate
- [ ] Responsive design adapts to screen sizes
- [ ] Animations work smoothly
- [ ] No console errors

### 3. Accessibility Testing

```javascript
// Accessibility checks in generated HTML
function checkAccessibility() {
  // Ensure proper heading hierarchy
  const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
  // ... validation logic
  
  // Check color contrast
  const elements = document.querySelectorAll('[style*="color"]');
  // ... contrast validation
  
  // Verify keyboard navigation
  const focusableElements = document.querySelectorAll(
    'button, input, [tabindex]:not([tabindex="-1"])'
  );
  // ... keyboard navigation tests
}
```

## Performance Considerations

### 1. File Size Optimization

**CSS Optimization:**
- Minify CSS in production
- Remove unused styles
- Use CSS custom properties efficiently
- Optimize animations for performance

**JavaScript Optimization:**
- Minify JavaScript code
- Remove console.log statements
- Optimize DOM queries
- Use efficient event delegation

**Target File Size:** < 500KB for typical practice sets

### 2. Runtime Performance

**DOM Optimization:**
```javascript
// Efficient DOM updates
class DOMUpdater {
  constructor() {
    this.updateQueue = [];
    this.isUpdating = false;
  }
  
  queueUpdate(fn) {
    this.updateQueue.push(fn);
    if (!this.isUpdating) {
      this.processQueue();
    }
  }
  
  processQueue() {
    this.isUpdating = true;
    requestAnimationFrame(() => {
      this.updateQueue.forEach(fn => fn());
      this.updateQueue = [];
      this.isUpdating = false;
    });
  }
}
```

**Memory Management:**
```javascript
// Clean up event listeners and references
class PracticeApp {
  destroy() {
    // Remove event listeners
    this.eventListeners.forEach(({ element, event, handler }) => {
      element.removeEventListener(event, handler);
    });
    
    // Clear references
    this.questions = null;
    this.answers.clear();
  }
}
```

## Security Considerations

### 1. Content Security

**XSS Prevention:**
```javascript
// Sanitize user-generated content
function sanitizeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// Use textContent instead of innerHTML for user data
element.textContent = userInput; // Safe
// element.innerHTML = userInput; // Unsafe
```

### 2. Data Privacy

**No External Requests:**
- All functionality works offline
- No analytics or tracking
- No external font or library loading
- No data transmission

## Implementation Phases

### Phase 1: Core HTML Generation
- Create HTML template structure
- Implement CSS generation with ElevenLabs aesthetic
- Basic JavaScript functionality for navigation
- Simple download mechanism

### Phase 2: Question Type Implementation
- Matching question interface and logic
- Fill-in-the-blank question handling
- Multiple choice question functionality
- Progress tracking and results calculation

### Phase 3: Polish and Optimization
- Smooth animations and transitions
- Responsive design refinements
- Performance optimizations
- Cross-browser testing and fixes

### Phase 4: Integration and Testing
- Integration with existing practice generation
- Comprehensive testing across devices
- Accessibility improvements
- Final UI polish

## Design Decisions and Rationales

### 1. Self-Contained HTML File
**Decision:** Generate single HTML file with inline CSS and JavaScript
**Rationale:** Ensures offline functionality, easy sharing, no external dependencies

### 2. ElevenLabs Aesthetic
**Decision:** Use black/white/gray color scheme with generous whitespace
**Rationale:** Creates premium, professional appearance that matches user expectations

### 3. Progressive Enhancement
**Decision:** Core functionality works without JavaScript, enhanced with JS
**Rationale:** Ensures accessibility and graceful degradation

### 4. CSS-Only Animations
**Decision:** Use CSS transitions and animations instead of JavaScript
**Rationale:** Better performance, smoother animations, respects user motion preferences

### 5. Vanilla JavaScript
**Decision:** No external JavaScript libraries or frameworks
**Rationale:** Keeps file size small, eliminates dependencies, ensures compatibility